# MusicTrends

Using a rake import task, CSV data is loaded into a POSTGRES database. Rails and ActiveRecord are used to build a JSON API which exposes the MusicTrends data analysis, values generated by several different background workers using Redis/Sidekiq.

# Write up

This Rails API backend functions using the external, public 'GENIUS API', following search queries for songs with immediate keyword identification and analysis of associated tags, annotations (called referents), and posts known collectively as a song's `corpus`.

The as-of-yet unbuilt frontend would hypothetically be no more than a simple search bar, search engine, which would populate queries sent to the `/songsearch` endpoint with associated songs, then once a user clicks a song, would ping the `/songinfo` endpoint, which triggers a cascade of word-associations and keyword identification in SongWorker and SearchWorker models. Songs, Searches, and their associated keywords are saved to the database for later analysis. TrendWorker then analyzes these words and prints to a AWS s3 bucket its findings.

My overall intent was to build an app that, as its dataset grew by more and more song searches, would be able to find patterns in the searches, namely, but not limited to:

* most popular words in corpus
* most popular concepts in corpus
* most popular words across all searches
* target-word matches: (i.e. Products (Apple, Android), Buzzwords:(hurricane, Lakers), Names: (Trump, Putin))
* playcount
* search
* identified categories / contexts for songs / searches
* possible categories / contexts for songs / searches

##Getting Started

Music Trends is a Ruby on Rails application that requires both Ruby and Rails to be installed on your machine

Ruby:
From your bash run:
```
ruby -v
```

You should see something similar to:
```
ruby 2.4.1p111 (2017-03-22 revision 58053) [x86_64-darwin16]
```

Follow a similar process for Rails:
```
rails -v
```

You should see something similar to:
```
Rails 5.1.3
```

If Ruby or Rails is not installed on your machine, please see the following links:
* https://www.ruby-lang.org/en/documentation/installation/
* http://railsapps.github.io/installrubyonrails-mac.html

## Worker Queue

MusicTrends also requires you to have sidekiq and redis installed on your local machine. To check if you have redis installed,

Redis:
From your bash run:
```
redis-server --version
```

You should see something similar to:
```
Redis server v=4.0.2 sha=00000000:0 malloc=libc bits=64 build=7db4e866648bf9c0
```

To launch redis, from a different terminal window/tab, run:
```
redis-server
```

Sidekiq:
To launch sidekiq in development, from a different terminal tab run:
```
bundle exec sidekiq  
```

Once you think sidekiq is running, you can check with this command:
```
ps aux | grep '[s]idekiq'
```

For Sidekiqtrouble-shooting, visit :
* https://github.com/mperham/sidekiq

For Redis troubleshooting:
* https://medium.com/@petehouston/install-and-config-redis-on-mac-os-x-via-homebrew-eb8df9a4f298


After ensuring you have Ruby, Redis, and Rails installed, clone this project to your desired directory:
```
git clone git@github.com:thedanielvogelsang/musicTrends_app.git
```

Change directory to musicTrends_app:
```
cd musicTrends_app
```

Bundle:
```
bundle install
```

Create Database:
```
rake db:create
```

Migrate Database:
```
rake db:migrate  
```

## Using MusicTrends
Your Music Trends app is ready to go.

* MusicTrends is intended to be a private api in addition to utilizing several secret ids/keys, to hook up your own AWS and Genius connections, make sure you run

```
bundle exec figaro install
```
and add the following to your application.yml file:
```
CLIENT_ID: 'genius client id'
CLIENT_SECRET: 'genius client secret'
ACCESS_TOKEN: 'genius access token'

AWS_ACCESS_KEY_ID: 'aws access key id'
AWS_SECRET_ACCESS_KEY: 'aws secret access key'
S3_REGION: 'us-east-1'
S3_BUCKET: '#/yourbucketname'

X-MT-TOKEN: 'private-api-token-only-you-know-about'
```

Testing/Seeding database:

To operate the developer-built testing suite, you'll need to first create a secrets file and store your Genius CLIENT_ID and CLIENT_SECRET / ACCESS_TOKEN.  (^^ ABOVE ^^)

Run seed file and import GeniusApi songs as Song records, as well as run data analysis via SongWorker and TagWorker:
```
rake db:seed

```
RSpec is the primary testing tool used for this project. To run it, type:
```
rspec
```

Launching Rails in your local environment:
```
rails s
```

Once you see something similar to:
```
=> Booting Puma
=> Rails 5.1.3 application starting in development on http://localhost:3000
=> Run `rails server -h` for more startup options
Puma starting in single mode...
* Version 3.9.1 (ruby 2.4.1-p111), codename: Private Caller
* Min threads: 5, max threads: 5
* Environment: development
* Listening on tcp://0.0.0.0:3000
Use Ctrl-C to stop
```

Note: http://localhost:3000 is the URL of the locally launched project.

# API ENDPOINTS

Head to Postman or some other preferred request/response GUI and consider the following:

```
`/songsearch` -> params: {query: "query string"}
`/songinfo` -> params: {song_id: 3, search: {text: "query string"}}

GET `/songs`
GET `/songs/:id`
GET `/searches`
GET `/searches/:id`
GET `/tags`
GET `/tags/:id`
POST `/tags` -> params: {tags: {context: 'string', key_words: ["key1", "key2"]}}
PUT/PATCH `/tags/:id` -> params: {tags: {context: 'string', key_words: ["key1", "key2"]}}
DELETE `/tags/:id`
```
note: tags must have a minimum of 5 key_words to be created successfully

example Tag creation post:

```
request.headers:
X-MT-TOKEN: 'private token'

params:
{
  tags: {
    context: "1990s"
    keywords: [
      "Barbie",
      "skateboard",
      "grunge rock"
      "hotpockets",
      "Saved by the Bell",
      "Disney Channel",
      "Nickolodeon",
      "jeans",
      "some other 1990s word"
    ]
  }
}

`POST `http://localhost:3000/tags/``

```
##Authors

* **Daniel Vogelsang** - [GitHub](https://github.com/thedanielvogelsang)
